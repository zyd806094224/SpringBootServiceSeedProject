# 文件上传接口文档

## 功能概述

本项目实现了一个完整的文件上传功能，包括单文件上传、多文件上传、文件删除、文件信息获取等功能。

## 接口列表

### 1. 单文件上传

**接口地址**: `POST /file/upload`

**请求参数**:
- `file` (MultipartFile): 要上传的文件

**返回格式**:
```json
{
  "code": 200,
  "msg": "成功",
  "total": 0,
  "data": {
    "originalName": "test.txt",
    "newName": "c7225455-f248-45bf-8f8d-2ceef52f09c4.txt",
    "fileSize": 60,
    "fileType": ".txt",
    "filePath": "/Users/zhaoyudong/IdeaProjects/SpringBootServiceSeedProject/uploads/c7225455-f248-45bf-8f8d-2ceef52f09c4.txt",
    "fileUrl": "/uploads/c7225455-f248-45bf-8f8d-2ceef52f09c4.txt",
    "success": true,
    "message": "文件上传成功"
  }
}
```

**测试命令**:
```bash
curl --noproxy "*" -X POST -F "file=@test.txt" http://localhost:8060/file/upload
```

### 2. 多文件上传

**接口地址**: `POST /file/uploadMultiple`

**请求参数**:
- `files` (MultipartFile[]): 要上传的文件数组

**返回格式**:
```json
{
  "code": 200,
  "msg": "成功",
  "total": 0,
  "data": {
    "success": true,
    "message": "文件上传完成",
    "totalCount": 2,
    "successCount": 2,
    "failedCount": 0,
    "successFiles": [...],
    "failedFiles": [...]
  }
}
```

**测试命令**:
```bash
curl --noproxy "*" -X POST -F "files=@file1.txt" -F "files=@file2.txt" http://localhost:8060/file/uploadMultiple
```

### 3. 文件删除

**接口地址**: `DELETE /file/delete/{fileName}`

**路径参数**:
- `fileName`: 要删除的文件名

**返回格式**:
```json
{
  "code": 200,
  "msg": "成功",
  "total": 0,
  "data": "文件删除成功"
}
```

**测试命令**:
```bash
curl --noproxy "*" -X DELETE http://localhost:8060/file/delete/c7225455-f248-45bf-8f8d-2ceef52f09c4.txt
```

### 4. 获取文件信息

**接口地址**: `GET /file/info/{fileName}`

**路径参数**:
- `fileName`: 文件名

**返回格式**:
```json
{
  "code": 200,
  "msg": "成功",
  "total": 0,
  "data": {
    "fileName": "c7225455-f248-45bf-8f8d-2ceef52f09c4.txt",
    "fileSize": 60,
    "filePath": "/Users/zhaoyudong/IdeaProjects/SpringBootServiceSeedProject/uploads/c7225455-f248-45bf-8f8d-2ceef52f09c4.txt",
    "exists": true,
    "fileUrl": "/uploads/c7225455-f248-45bf-8f8d-2ceef52f09c4.txt",
    "lastModified": 1761371573976,
    "fileType": ".txt"
  }
}
```

**测试命令**:
```bash
curl --noproxy "*" http://localhost:8060/file/info/c7225455-f248-45bf-8f8d-2ceef52f09c4.txt
```

### 5. 检查文件是否存在

**接口地址**: `GET /file/exists/{fileName}`

**路径参数**:
- `fileName`: 文件名

**返回格式**:
```json
{
  "code": 200,
  "msg": "成功",
  "total": 0,
  "data": {
    "fileName": "c7225455-f248-45bf-8f8d-2ceef52f09c4.txt",
    "exists": true
  }
}
```

**测试命令**:
```bash
curl --noproxy "*" http://localhost:8060/file/exists/c7225455-f248-45bf-8f8d-2ceef52f09c4.txt
```

## 配置说明

### 文件上传配置 (application.yml)
```yaml
# 文件上传配置
file:
  upload:
    # 上传目录
    path: ${user.dir}/uploads
    # 允许的文件类型
    allowed-types: .jpg,.jpeg,.png,.gif,.bmp,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar
    # 最大文件大小（字节）
    max-size: 10485760  # 10MB
    # 一次最多上传文件数量
    max-count: 10
```

### Spring Boot 文件上传配置
```yaml
spring:
  servlet:
    multipart:
      # 启用文件上传
      enabled: true
      # 最大文件大小
      max-file-size: 10MB
      # 最大请求大小
      max-request-size: 100MB
      # 文件大小阈值
      file-size-threshold: 0
      # 临时文件位置
      location: ${java.io.tmpdir}
```

## 安全配置

文件上传接口已配置为允许匿名访问，无需JWT认证即可使用。在 `SecurityConfig.java` 中添加了以下配置：

```java
.requestMatchers("/file/**").anonymous()
```

## 文件存储

- 文件默认存储在项目根目录下的 `uploads` 文件夹中
- 文件名使用UUID重命名，避免文件名冲突
- 支持通过 `/uploads/{fileName}` URL直接访问上传的文件

## 错误处理

接口提供了完善的错误处理，包括：
- 文件为空检查
- 文件大小限制检查
- 文件类型限制检查
- 文件数量限制检查

## 测试结果

所有接口已通过测试验证：
- ✅ 单文件上传
- ✅ 文件存在检查
- ✅ 文件信息获取
- ✅ 文件删除

文件上传功能已成功集成到SpringBoot项目中，可以正常使用。